# This is a dummy test to demonstrate our ability to execute tests in Fallout. Delete it when we have a real test scenario in place.
ensemble:
  server:
    node.count: 1
    provisioner:
      name: ctool
      properties:
        cloud.provider: nebula
        cloud.instance.type: m3.large
    configuration_manager:
      - name: ctool
        properties:
          product.type: dse
          product.install.type: tarball
          product.version: 6.0.4
  client: server

workload:
  phases:
    - load-data:
        module: bash
        properties:
          #script will run at first and last node of server cluster
          target.group: server
          target.ordinals: 0,2
          timeout: 20m
          failure_regexes:
              - "error\\smessage"
              - ".*Exception.*"
          script: | 
              echo "This bash module exports system variables that are accessible." 
              echo "All the properties of ConfigurationManager is exported, substituting '.' by '_' underscore (FALLOUT_<node group name>_<property>)."
              echo "General information:"
              echo " - FALLOUT_SCRATCH_DIR : script work dir"
              echo $FALLOUT_SCRATCH_DIR
              echo " - FALLOUT_ARTIFACT_DIR : target folder that have to be used for all exported resources: outputs, etc.."
              echo $FALLOUT_ARTIFACT_DIR
              echo " - FALLOUT_NODE_ID : node ordinal number"
              echo $FALLOUT_NODE_ID
              echo "If a product is installed: "
              echo " - FALLOUT_SERVER_INSTALLED_PRODUCT : DSE, CASSANDRA, SCYLLA"
              echo $FALLOUT_SERVER_INSTALLED_PRODUCT
              echo " - FALLOUT_SERVER_PRODUCT_VERSION ex: 5.1.2"
              echo $FALLOUT_SERVER_PRODUCT_VERSION
              echo "If is there a CassandraProvider available, those variables will be exported: "
              echo " - FALLOUT_SERVER_PRODUCT_CONTACT_POINT"
              echo $FALLOUT_SERVER_PRODUCT_CONTACT_POINT
              echo " - FALLOUT_SERVER_PRODUCT_CONTACT_POINTS : list of contact points"
              echo $FALLOUT_SERVER_PRODUCT_CONTACT_POINT
              echo " - FALLOUT_SERVER_PRODUCT_EXPECTS_SSL"
              echo $FALLOUT_SERVER_PRODUCT_EXPECTS_SSL
              echo "If is there a GraphiteProvider available, those variables will be exported: "
              echo " - FALLOUT_GRAPHITE_HOST"
              echo $FALLOUT_GRAPHITE_HOST
              echo " - FALLOUT_GRAPHITE_PORT"
              echo $FALLOUT_GRAPHITE_PORT
  checkers:
    nofail:
      checker: nofail

